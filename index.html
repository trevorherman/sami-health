<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="Sami Health">
<meta name="theme-color" content="#7C6BC4">
<link rel="manifest" href="./manifest.json">
<link rel="apple-touch-icon" href="./apple-touch-icon.png">
<title>Sami's Health Tracker</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body,#root{height:100%;width:100%}
body{font-family:'DM Sans',-apple-system,BlinkMacSystemFont,sans-serif;-webkit-font-smoothing:antialiased;overflow:hidden}
input[type=range]{-webkit-appearance:none;appearance:none;height:6px;border-radius:3px;outline:none}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:20px;height:20px;border-radius:50%;background:#7C6BC4;cursor:pointer;border:2px solid #fff;box-shadow:0 1px 4px rgba(0,0,0,.2)}
input[type=time],input[type=number],textarea{-webkit-appearance:none;font-family:inherit}
::-webkit-scrollbar{width:0;height:0}
</style>
</head>
<body>
<div id="root"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<script>
// Nuke old service workers that might be caching bad stuff
if('serviceWorker'in navigator){navigator.serviceWorker.getRegistrations().then(function(r){r.forEach(function(w){w.unregister()})}).then(function(){navigator.serviceWorker.register('./sw.js').catch(function(){})});}

(function(){
"use strict";
var h=React.createElement, useState=React.useState, useEffect=React.useEffect, useCallback=React.useCallback, useRef=React.useRef;
var SK="sami-ht-v3";

/* ─── Chart.js wrapper ─── */
function CChart(props){
  var ref=useRef(null),ch=useRef(null);
  useEffect(function(){
    if(ch.current)ch.current.destroy();
    if(!ref.current)return;
    var ctx=ref.current.getContext('2d');
    ch.current=new Chart(ctx,{type:props.type,data:props.data,options:Object.assign({responsive:true,maintainAspectRatio:false,animation:{duration:300},plugins:{legend:{display:!!props.legend,labels:{font:{size:10,family:'DM Sans'},usePointStyle:true,padding:12}},tooltip:{backgroundColor:props.tooltipBg||'#fff',titleColor:'#3D3155',bodyColor:'#8A7FA0',borderColor:props.borderC||'#E4DDED',borderWidth:1,titleFont:{size:11,family:'DM Sans'},bodyFont:{size:11,family:'DM Sans'},padding:8,cornerRadius:8,displayColors:true}},scales:props.scales||{}},props.opts||{})});
    return function(){if(ch.current){ch.current.destroy();ch.current=null}};
  },[JSON.stringify(props.data),props.type]);
  return h('div',{style:{height:props.height||160,position:'relative'}},h('canvas',{ref:ref}));
}

/* ─── Colors ─── */
var C={
  light:{bg:"#F5F0F7",bgCard:"#FFFFFF",bgCardAlt:"#F0EBF4",primary:"#7C6BC4",primaryLight:"rgba(124,107,196,.12)",primaryMid:"rgba(124,107,196,.25)",success:"#6BA38C",successLight:"rgba(107,163,140,.12)",warning:"#D4A054",warningLight:"rgba(212,160,84,.12)",alert:"#C47EB0",alertLight:"rgba(196,126,176,.12)",accent:"#5BA4C9",accentLight:"rgba(91,164,201,.12)",text:"#3D3155",textMuted:"#8A7FA0",textLight:"#B0A8C0",border:"#E4DDED",borderLight:"#EDE8F2",crisis:"#9B59B6",streak:"#E8B84B",reward:"#F0C75E"},
  dark:{bg:"#1C1726",bgCard:"#2A2338",bgCardAlt:"#322A42",primary:"#A594E0",primaryLight:"rgba(165,148,224,.12)",primaryMid:"rgba(165,148,224,.25)",success:"#7DB892",successLight:"rgba(125,184,146,.12)",warning:"#E8C477",warningLight:"rgba(232,196,119,.12)",alert:"#D49BC4",alertLight:"rgba(212,155,196,.12)",accent:"#7BBDE0",accentLight:"rgba(123,189,224,.12)",text:"#E8E0F0",textMuted:"#9A8FB0",textLight:"#6A5F80",border:"#3E3550",borderLight:"#332A45",crisis:"#B07ACC",streak:"#F0D06E",reward:"#F5DA80"}
};

/* ─── Quotes ─── */
var QQ=[
  {t:"You don't have to feel great to show up. Showing up IS the win.",a:"Your Tracker"},
  {t:"Healing isn't linear. A bad day doesn't erase your progress.",a:"Reminder"},
  {t:"Tracking means you're fighting for yourself. That's powerful.",a:"Truth"},
  {t:"Rest is not quitting. Rest is how warriors reload.",a:"Your corner"},
  {t:"Small steps still move you forward.",a:"Math"},
  {t:"You've survived 100% of your worst days. Undefeated.",a:"The stats"},
  {t:"Your body is doing its best. Be kind to it today.",a:"A nudge"},
  {t:"Consistency beats perfection. Always.",a:"Every streak ever"},
  {t:"Data is power. Every entry is ammunition for healing.",a:"Your advocate"},
  {t:"Even on a 1/10 day, you're a 10/10 human.",a:"Trevor, probably"},
  {t:"1,000+ days on Duolingo? This tracker doesn't stand a chance.",a:"Confidence"},
  {t:"The doctors haven't figured it out, but the data might.",a:"Hope"},
  {t:"Breathe in 4. Hold 4. Out 6. You just did something healing.",a:"Right now"},
  {t:"A streak doesn't break from one missed day. It pauses.",a:"Grace"},
  {t:"Ice cream tastes even better when you've earned it.",a:"Motivation"},
  {t:"You are building a case file for your health. Detective-level.",a:"Respect"},
  {t:"Every good day proves what's possible. Every bad day shows what to investigate.",a:"Both matter"},
  {t:"This isn't about perfection. It's about receipts for your doctor.",a:"Practical magic"},
  {t:"Plot twist: taking care of yourself IS productive.",a:"Reframe"},
  {t:"Nobody who knows your story could call you anything but strong.",a:"Fact"},
];
function gQ(d){var n=d.split("-").reduce(function(a,b){return a+parseInt(b)},0);return QQ[n%QQ.length]}

/* ─── Info ─── */
var NF={
  restingHR:{t:"Why track resting HR?",b:"Measured lying down \u2014 a window into your autonomic nervous system. For POTS, a 30+ bpm jump on standing is a key marker."},
  standingHR:{t:"Why standing HR?",b:"Normal standing raises HR 10-15 bpm. With POTS it can spike 30+ or above 120. Logging both builds evidence."},
  morningHydration:{t:"Why 16oz first thing?",b:"After sleep, you're dehydrated. 16oz right away stabilizes your cardiovascular system."},
  electrolytes:{t:"Why electrolytes?",b:"Sodium helps retain water and blood volume. Extra sodium (1000-3000mg/day) reduces dizziness, brain fog, and HR spikes."},
  antimicrobial:{t:"Why before noon with food?",b:"Food prevents GI upset. Die-off reactions release neurotoxins \u2014 earlier means your body processes them during the day."},
  magnesiumGlycinate:{t:"Why magnesium glycinate?",b:"Gentlest form. Supports relaxation, sleep, reduced anxiety, digestion. Take before 6 PM. 200-400mg daily."},
  vitK2:{t:"Why Vitamin K2?",b:"Directs calcium to bones, supports blood clotting. Take with fat. 100-200mcg daily (MK-7 form)."},
  vitB2:{t:"Why Vitamin B2?",b:"Essential for cellular energy. Deficiency causes fatigue, light sensitivity, migraines. 25-400mg daily."},
  multivitamin:{t:"Why a multivitamin?",b:"Chronic issues use nutrients faster. Fills gaps when appetite is low. Nutritional insurance!"},
  digestiveEnzymes:{t:"Why digestive enzymes?",b:"Helps break down food completely. For bloating, burping, gas, or nausea. Take WITH meals."},
  gabapentin:{t:"Why Gabapentin at bedtime?",b:"Calms overactive nerves. Reduces anxiety, helps sleep. Same time each night for steady levels."},
  unisom:{t:"About Unisom/Doxylamine",b:"Antihistamine sleep aid. At >50mg can cause 'wired but tired.' Track doses to find your sweet spot."},
  vagalBreathing:{t:"Vagal Breathing",b:"Vagus nerve = body's 'calm down' switch.\n\n1. IN through nose \u2014 4 sec\n2. HOLD \u2014 4 sec\n3. OUT through mouth \u2014 6-8 sec\n4. Longer exhale is KEY!\n\nEven 2-3 min helps!"},
  screenFree:{t:"Why screen-free?",b:"Blue light = 'stay awake' signal. 1-2 hours screen-free lets melatonin happen naturally."},
  bedroomPrep:{t:"Why cool, dark, quiet?",b:"Body temp must DROP to sleep. Cool (65-68\u00B0F), darkness, quiet. Biology!"},
  movement:{t:"Why track movement?",b:"Even 10-15 min walking regulates autonomic system, circulation, digestion, mood."},
  wiredButTired:{t:"Wired but tired?",b:"Body EXHAUSTED but mind RACING. Sympathetic system in overdrive. Triggers: high Unisom, caffeine, anxiety, die-off, hormones."},
  periodTracking:{t:"Why track your cycle?",b:"Hormones affect ALL symptoms. Worst days often cluster days 20-28."},
  painNew:{t:"Pain tracking",b:"This tracks NEW/DIFFERENT pain above your usual baseline. 0 = 'just normal,' 10 = 'worst new pain.'"},
  sleepQuality:{t:"Sleep quality",b:"Not hours \u2014 how restorative?\n1-2: Barely slept\n3-4: Woke constantly\n5-6: Okay\n7-8: Restored\n9-10: Amazing"},
  dayRating:{t:"Why rate your day?",b:"Simple ratings create powerful patterns. Bad clusters reveal triggers. Good clusters reveal your healing formula."},
};

/* ─── Utilities ─── */
function fd(d){return d.toISOString().split("T")[0]}
function dn(s){return new Date(s+"T12:00:00").toLocaleDateString("en-US",{weekday:"short"})}
function sd(s){return new Date(s+"T12:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"})}
function av(a){return a.length?(a.reduce(function(x,y){return x+y},0)/a.length).toFixed(1):"\u2014"}
function gS(logs){var t=new Date(),s=0;for(var i=0;i<365;i++){var d=new Date(t);d.setDate(d.getDate()-i);var k=fd(d),l=logs[k];if(l&&!l._isSample&&l.dayRating)s++;else if(i===0)continue;else break}return s}
function gR(s){if(s>=30)return{e:"\uD83D\uDC51",m:"30-day warrior!",r:"Spa day earned!"};if(s>=21)return{e:"\u2B50",m:"21 days \u2014 HABIT!",r:"Pick dessert!"};if(s>=14)return{e:"\uD83D\uDD25",m:"Two weeks strong!",r:"Treat yourself!"};if(s>=7)return{e:"\uD83C\uDF66",m:"7-DAY STREAK!",r:"ICE CREAM! \uD83C\uDF66"};if(s>=3)return{e:"\u2B50",m:s+" days!",r:null};if(s>=1)return{e:"\u2728",m:"Day "+s+"!",r:null};return{e:"\uD83C\uDF31",m:"Start your streak!",r:null}}
function cA(l){if(!l||!l.treatments)return 0;var t=l.treatments;return Math.round([t.morningHR,t.morningHydration,t.morningElectrolytes,t.antimicrobial,t.magnesium,t.digestiveEnzymes,t.multivitamin,t.bedtimeProtocol].filter(Boolean).length/8*100)}

function genSample(){var today=new Date(),logs={};
[{o:-6,w:"11:15",b:"21:45",sq:7,e:6,a:4,n:2,mo:7,r:"good",p:"none",cd:20,rh:78,sh:95,ad:90,wk:1,rs:true,u:25,wi:false,dz:2,bu:1,pc:0,no:"Good day. Slept in.",ew:false},
{o:-5,w:"11:30",b:"22:00",sq:6,e:5,a:5,n:3,mo:6,r:"okay",p:"none",cd:21,rh:82,sh:102,ad:80,wk:2,rs:false,u:25,wi:false,dz:3,bu:3,pc:0,no:"Okay day.",ew:false},
{o:-4,w:"07:30",b:"21:30",sq:3,e:2,a:8,n:6,mo:3,r:"bad",p:"spotting",cd:22,rh:98,sh:128,ad:55,wk:4,rs:false,u:50,wi:true,dz:7,bu:6,pc:1,no:"Forced early wake. Exhausted.",ew:true},
{o:-3,w:"12:00",b:"22:00",sq:5,e:4,a:6,n:4,mo:5,r:"okay",p:"light",cd:23,rh:88,sh:110,ad:75,wk:2,rs:false,u:50,wi:true,dz:4,bu:4,pc:0,no:"Recovering.",ew:false},
{o:-2,w:"08:00",b:"21:00",sq:2,e:1,a:9,n:7,mo:2,r:"crisis",p:"medium",cd:24,rh:105,sh:135,ad:40,wk:5,rs:false,u:75,wi:true,dz:8,bu:7,pc:2,no:"Crisis. HR>120.",ew:true},
{o:-1,w:"12:30",b:"21:30",sq:5,e:3,a:7,n:5,mo:4,r:"bad",p:"medium",cd:25,rh:92,sh:118,ad:65,wk:3,rs:false,u:50,wi:true,dz:5,bu:5,pc:1,no:"Recovering. Anxiety high.",ew:false}
].forEach(function(d){var dt=new Date(today);dt.setDate(dt.getDate()+d.o);var k=fd(dt);
logs[k]={_isSample:true,date:k,sleep:{bedtime:d.b,wakeTime:d.w,quality:d.sq,wakings:d.wk,feltRested:d.rs,medication:{gabapentin:{taken:true,dose:400},unisom:{taken:d.u>0,dose:d.u}}},vitals:{morningHR:d.rh,standingHR:d.sh},symptoms:{anxiety:d.a,nausea:d.n,energy:d.e,mood:d.mo,dizziness:d.dz,burping:d.bu,panicCount:d.pc,wiredButTired:d.wi,irritability:Math.max(0,d.a-2)},treatments:{morningHR:d.ad>50,morningHydration:d.ad>50,morningElectrolytes:d.ad>50,antimicrobial:d.ad>60,magnesium:d.ad>50,digestiveEnzymes:d.ad>60,multivitamin:d.ad>50,vitK2:d.ad>60,vitB2:d.ad>60,movement:d.e>3,bedtimeProtocol:d.ad>70,screenFree:d.ad>75,vagalBreathing:d.wi},menstrual:{status:d.p,cycleDay:d.cd},notes:d.no,dayRating:d.r,crisisEvents:[],earlyWake:d.ew,stressLevel:Math.min(10,d.a+1)};});return logs}

/* ─── UI Atoms ─── */
function IB(p){var _s=useState(false),o=_s[0],so=_s[1];var info=NF[p.ik];if(!info)return null;var c=p.c;
return h(React.Fragment,null,
  h('button',{onClick:function(e){e.stopPropagation();so(!o)},style:{background:o?c.primaryLight:"none",border:"1.5px solid "+(o?c.primary:c.border),borderRadius:12,width:22,height:22,fontSize:11,color:c.primary,cursor:"pointer",display:"inline-flex",alignItems:"center",justifyContent:"center",fontWeight:700,flexShrink:0}},"?"),
  o?h('div',{onClick:function(e){e.stopPropagation()},style:{background:c.bgCard,border:"1.5px solid "+c.primary,borderRadius:14,padding:16,margin:"8px 0 4px",boxShadow:"0 4px 20px "+c.primaryLight}},
    h('div',{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8}},h('span',{style:{fontSize:13,fontWeight:700,color:c.primary}},info.t),h('button',{onClick:function(){so(false)},style:{background:"none",border:"none",fontSize:16,color:c.textMuted,cursor:"pointer"}},"\u2715")),
    h('p',{style:{fontSize:13,color:c.text,lineHeight:1.65,margin:0,whiteSpace:"pre-line"}},info.b)):null);}

function Sl(p){var c=p.c;return h('div',{style:{marginBottom:16}},
  h('div',{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4,gap:8}},
    h('div',{style:{display:"flex",alignItems:"center",gap:6,flex:1}},h('span',{style:{fontSize:14,fontWeight:600,color:c.text}},p.label),p.ik?h(IB,{ik:p.ik,c:c}):null),
    h('span',{style:{fontSize:14,fontWeight:700,color:c.primary,minWidth:24,textAlign:"right"}},p.value!=null?p.value:"\u2014")),
  h('input',{type:"range",min:0,max:10,value:p.value!=null?p.value:5,onChange:function(e){p.onChange(Number(e.target.value))},style:{width:"100%",accentColor:c.primary,background:c.borderLight}}),
  h('div',{style:{display:"flex",justifyContent:"space-between",fontSize:11,color:c.textMuted,marginTop:2}},h('span',null,p.lo||"0"),h('span',null,p.hi||"10")));}

function Tg(p){var c=p.c;return h('div',{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 0",borderBottom:"1px solid "+c.borderLight}},
  h('span',{onClick:function(){p.onChange(!p.value)},style:{fontSize:14,color:c.text,cursor:"pointer",flex:1}},p.label),
  h('div',{style:{display:"flex",alignItems:"center",gap:8}},
    p.ik?h(IB,{ik:p.ik,c:c}):null,
    h('div',{onClick:function(){p.onChange(!p.value)},style:{width:48,height:28,borderRadius:14,background:p.value?c.success:c.border,transition:"all .2s",cursor:"pointer",position:"relative",flexShrink:0}},
      h('div',{style:{width:22,height:22,borderRadius:11,background:"#fff",position:"absolute",top:3,left:p.value?23:3,transition:"all .2s",boxShadow:"0 1px 3px rgba(0,0,0,.2)"}}))));}

function Cd(p){return h('div',{style:Object.assign({background:p.c.bgCard,borderRadius:16,padding:20,marginBottom:12,border:"1px solid "+p.c.border},p.style||{})},p.children);}
function Pl(p){return h('button',{onClick:p.onClick,style:{padding:"6px 14px",borderRadius:20,border:"none",background:p.active?(p.color||p.c.primary):p.c.bgCardAlt,color:p.active?"#fff":p.c.textMuted,fontSize:13,fontWeight:600,cursor:"pointer"}},p.text);}

function CI(p){var c=p.c;return h('div',{style:{display:"flex",alignItems:"flex-start",gap:12,padding:"12px 0",borderBottom:"1px solid "+c.borderLight}},
  h('div',{onClick:p.onToggle,style:{width:28,height:28,borderRadius:8,border:"2px solid "+(p.checked?c.success:c.border),background:p.checked?c.success:"transparent",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,marginTop:2,cursor:"pointer"}},p.checked?h('span',{style:{color:"#fff",fontSize:16,fontWeight:700}},"\u2713"):null),
  h('div',{style:{flex:1}},
    h('div',{style:{display:"flex",alignItems:"center",gap:6,flexWrap:"wrap"}},
      h('span',{onClick:p.onToggle,style:{fontSize:14,color:p.checked?c.textMuted:c.text,textDecoration:p.checked?"line-through":"none",fontWeight:500,cursor:"pointer"}},p.icon?p.icon+" ":"",p.label),
      p.infoKey?h(IB,{ik:p.infoKey,c:c}):null),
    p.sublabel?h('div',{style:{fontSize:12,color:c.textMuted,marginTop:2}},p.sublabel):null,
    p.warning&&!p.checked?h('div',{style:{fontSize:12,color:c.warning,marginTop:4,fontWeight:500}},"\u26A0\uFE0F "+p.warning):null));}

function SH(p){return h('h3',{style:{margin:"8px 0 12px",fontSize:16,fontWeight:700,color:p.c.text,display:"flex",alignItems:"center",gap:8}},p.icon?h('span',null,p.icon):null,p.title);}
function SB(p){return h('div',{style:{textAlign:"center",flex:1,padding:"12px 8px",background:p.c.bgCardAlt,borderRadius:12}},h('div',{style:{fontSize:26,fontWeight:800,color:p.color||p.c.primary,lineHeight:1.1}},p.value!=null?p.value:"\u2014",p.unit?h('span',{style:{fontSize:13,fontWeight:500}},p.unit):null),h('div',{style:{fontSize:11,color:p.c.textMuted,marginTop:4}},p.label));}
function Ct(p){return h('div',{style:{display:"flex",alignItems:"center",gap:12,marginBottom:12}},h('span',{style:{fontSize:13,fontWeight:600,color:p.c.text}},p.label),h('button',{onClick:function(){p.onChange(Math.max(0,p.value-1))},style:{width:36,height:36,borderRadius:10,border:"1px solid "+p.c.border,background:p.c.bgCardAlt,fontSize:18,color:p.c.text,cursor:"pointer"}},"\u2212"),h('span',{style:{fontSize:20,fontWeight:700,color:p.color||p.c.primary,minWidth:24,textAlign:"center"}},p.value),h('button',{onClick:function(){p.onChange(p.value+1)},style:{width:36,height:36,borderRadius:10,border:"1px solid "+p.c.border,background:p.c.bgCardAlt,fontSize:18,color:p.c.text,cursor:"pointer"}},"+"));}

/* ════════════ MAIN APP ════════════ */
function App(){
  var _d=useState(false),dark=_d[0],setDark=_d[1];
  var _t=useState("today"),tab=_t[0],setTab=_t[1];
  var _l=useState({}),logs=_l[0],setLogs=_l[1];
  var _cr=useState(false),crisis=_cr[0],setCrisis=_cr[1];
  var _ob=useState(false),onboard=_ob[0],setOnboard=_ob[1];
  var _os=useState(0),obS=_os[0],setObS=_os[1];
  var _pr=useState({bedtime:"21:30",wakeTime:"11:00"}),prefs=_pr[0],setPrefs=_pr[1];
  var _ls=useState("morning"),logSub=_ls[0],setLogSub=_ls[1];
  var _ir=useState(7),insR=_ir[0],setInsR=_ir[1];
  var _ld=useState(false),loaded=_ld[0],setLoaded=_ld[1];
  var _es=useState(false),expShow=_es[0],setExpShow=_es[1];
  var _et=useState(""),expTxt=_et[0],setExpTxt=_et[1];
  var _vd=useState(null),vDate=_vd[0],setVDate=_vd[1];
  var _qd=useState(false),qDis=_qd[0],setQDis=_qd[1];
  var _ss=useState(true),samShow=_ss[0],setSamShow=_ss[1];
  var _im=useState(false),impShow=_im[0],setImpShow=_im[1];

  var tk=fd(new Date()),ad=vDate||tk,isPast=vDate&&vDate!==tk;
  var c=dark?C.dark:C.light;
  var now=new Date(),hr=now.getHours();
  var greet=hr<12?"Good morning":hr<17?"Good afternoon":"Good evening";

  useEffect(function(){if(hr>=20||hr<6)setDark(true)},[]);
  useEffect(function(){try{var d=JSON.parse(localStorage.getItem(SK));if(d&&d.logs&&Object.keys(d.logs).length){setLogs(d.logs);if(d.prefs)setPrefs(d.prefs);if(d.dark!==undefined)setDark(d.dark);setSamShow(Object.values(d.logs).some(function(l){return l._isSample}));setLoaded(true);return}}catch(e){}setLogs(genSample());setOnboard(true);setLoaded(true)},[]);
  var svRef=useRef(null);
  useEffect(function(){if(!loaded)return;clearTimeout(svRef.current);svRef.current=setTimeout(function(){try{localStorage.setItem(SK,JSON.stringify({logs:logs,prefs:prefs,dark:dark}))}catch(e){}},500)},[logs,prefs,dark,loaded]);

  function eL(d){return{date:d,sleep:{bedtime:null,fellAsleep:null,wakeTime:null,quality:null,wakings:0,feltRested:null,medication:{gabapentin:{taken:false,dose:400},unisom:{taken:false,dose:0}}},vitals:{morningHR:null,standingHR:null},symptoms:{anxiety:null,nausea:null,energy:null,mood:null,dizziness:null,painNew:null,headache:null,burping:null,panicCount:0,wiredButTired:null,irritability:null,fatigue:null,appetite:null},treatments:{},menstrual:{status:"none",cycleDay:null},notes:"",dayRating:null,crisisEvents:[],earlyWake:false,stressLevel:null}}
  var gL=useCallback(function(d){return logs[d]||eL(d)},[logs]);
  var uL=useCallback(function(d,fn){setLogs(function(p){var ex=p[d]||eL(d),u=typeof fn==="function"?fn(ex):Object.assign({},ex,fn);if(u._isSample)delete u._isSample;return Object.assign({},p,function(){var o={};o[d]=u;return o}())})},[]);

  var cur=gL(ad),allD=Object.keys(logs).sort(),streak=gS(logs),rew=gR(streak);

  /* ─── Onboarding ─── */
  if(onboard){
    var steps=[{t:"Welcome, Sami! \uD83D\uDC9C",b:"Built just for you. Adapts to YOUR schedule, never judges."},{t:"Your Schedule \uD83D\uDE34",b:"Everything shifts when YOU wake up. Sleep in \u2014 it's medicine."},{t:"Tap the ? \uD83D\uDCA1",b:"Wonder why? Tap ? next to anything for plain-language explanations."},{t:"Streaks \uD83C\uDFC6",b:"1,000+ on Duolingo? We KNOW you can do this. Ice cream at day 7! \uD83C\uDF66"},{t:"Crisis Button \uD83D\uDEA8",b:"The purple button is always there. No pressure, just data."},{t:"Let's Go! \uD83D\uDC9C",b:"Sample data loaded. Clear in Settings when ready!"}];
    var s=steps[obS];
    return h('div',{style:{minHeight:"100vh",background:c.bg,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",padding:24}},
      h('div',{style:{maxWidth:380,width:"100%",textAlign:"center"}},
        h('div',{style:{display:"flex",gap:6,justifyContent:"center",marginBottom:32}},steps.map(function(_,i){return h('div',{key:i,style:{width:28,height:4,borderRadius:2,background:i<=obS?c.primary:c.border}})})),
        h('h1',{style:{fontSize:26,fontWeight:800,color:c.text,marginBottom:16}},s.t),
        h('p',{style:{fontSize:16,color:c.textMuted,lineHeight:1.6,marginBottom:40}},s.b),
        h('div',{style:{display:"flex",gap:12}},
          obS>0?h('button',{onClick:function(){setObS(obS-1)},style:{flex:1,padding:"14px 0",borderRadius:12,border:"2px solid "+c.border,background:"transparent",color:c.textMuted,fontSize:15,fontWeight:600,cursor:"pointer"}},"Back"):null,
          h('button',{onClick:function(){obS===steps.length-1?setOnboard(false):setObS(obS+1)},style:{flex:2,padding:"14px 0",borderRadius:12,border:"none",background:c.primary,color:"#fff",fontSize:15,fontWeight:700,cursor:"pointer"}},obS===steps.length-1?"Let's Go! \uD83D\uDC9C":"Next")),
        obS<steps.length-1?h('button',{onClick:function(){setOnboard(false)},style:{marginTop:16,background:"none",border:"none",color:c.textLight,fontSize:13,cursor:"pointer",display:"block",width:"100%",textAlign:"center"}},"Skip"):null));}

  /* ─── Date Nav ─── */
  function DN(){var cn=ad<tk;
    return h('div',{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:12,padding:"8px 4px",background:isPast?c.accentLight:"transparent",borderRadius:12}},
      h('button',{onClick:function(){var p=allD.filter(function(d){return d<ad});if(p.length)setVDate(p[p.length-1])},style:{background:"none",border:"none",fontSize:22,color:c.primary,cursor:"pointer",padding:"4px 12px"}},"\u2039"),
      h('div',{style:{textAlign:"center",flex:1}},
        h('div',{style:{fontSize:15,fontWeight:700,color:c.text}},ad===tk?"Today":sd(ad)+" ("+dn(ad)+")"),
        isPast?h('div',{style:{fontSize:11,color:c.accent,fontWeight:600}},"Viewing past"+(cur._isSample?" (sample)":"")):null),
      h('button',{onClick:function(){var n=allD.filter(function(d){return d>ad&&d<=tk});if(n.length)setVDate(n[0]===tk?null:n[0]);else setVDate(null)},disabled:!cn,style:{background:"none",border:"none",fontSize:22,color:cn?c.primary:c.textLight,cursor:cn?"pointer":"default",padding:"4px 12px"}},"\u203A"));}

  /* ─── TODAY ─── */
  function TodayView(){
    var log=cur,t=log.treatments||{},adh=cA(log),q=gQ(ad);
    var ns=hr>=20?"bed":hr>=17?"eve":hr>=12?"mid":hr>=8?"morn":"wake";
    function tg(f){if(f==="_g")uL(ad,function(p){return Object.assign({},p,{sleep:Object.assign({},p.sleep,{medication:Object.assign({},p.sleep&&p.sleep.medication,{gabapentin:{taken:!(p.sleep&&p.sleep.medication&&p.sleep.medication.gabapentin&&p.sleep.medication.gabapentin.taken),dose:400}})})})});else uL(ad,function(p){var tr=Object.assign({},p.treatments);tr[f]=!tr[f];return Object.assign({},p,{treatments:tr})})}
    function CL(items,title,st){return h(Cd,{c:c,style:st==="now"?{border:"2px solid "+c.primary,boxShadow:"0 0 16px "+c.primaryLight}:{}},
      h('div',{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8}},
        h('span',{style:{fontSize:14,fontWeight:700,color:c.text}},title),
        h('span',{style:{fontSize:11,fontWeight:600,color:st==="now"?c.primary:st==="done"?c.success:c.textMuted,padding:"3px 10px",borderRadius:8,background:st==="now"?c.primaryLight:st==="done"?c.successLight:"transparent"}},st==="now"?"\u23F0 DUE":st==="done"?"\u2713 DONE":"UPCOMING")),
      items.map(function(it,i){return h(CI,Object.assign({key:i},it,{c:c,onToggle:function(){tg(it.field)}}))}));}
    var yk=function(){var d=new Date(ad+"T12:00:00");d.setDate(d.getDate()-1);return fd(d)}(),yL=logs[yk];
    return h('div',null,
      h(DN,null),
      !qDis&&!isPast?h(Cd,{c:c,style:{background:"linear-gradient(135deg,"+c.primaryLight+","+c.accentLight+")",border:"1px solid "+c.primaryMid}},
        h('div',{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"}},
          h('div',{style:{flex:1}},h('div',{style:{fontSize:14,fontWeight:600,color:c.text,lineHeight:1.5,fontStyle:"italic",marginBottom:4}},"\u201C"+q.t+"\u201D"),h('div',{style:{fontSize:11,color:c.textMuted,fontWeight:600}},"\u2014 "+q.a)),
          h('button',{onClick:function(){setQDis(true)},style:{background:"none",border:"none",color:c.textLight,fontSize:16,cursor:"pointer",marginLeft:8,flexShrink:0}},"\u2715"))):null,
      h('div',{style:{marginBottom:16}},h('h1',{style:{margin:0,fontSize:26,fontWeight:800,color:c.text}},greet+", Sami \uD83D\uDC9C"),h('p',{style:{margin:"6px 0 0",fontSize:14,color:c.textMuted}},yL&&yL.sleep&&yL.sleep.quality?"Last night: "+yL.sleep.quality+"/10 sleep":"How are you feeling?")),
      streak>0&&!isPast?h(Cd,{c:c,style:{background:"linear-gradient(135deg,"+c.streak+"15,"+c.reward+"20)",border:"1.5px solid "+c.streak+"40"}},h('div',{style:{display:"flex",alignItems:"center",gap:12}},h('div',{style:{fontSize:36}},rew.e),h('div',{style:{flex:1}},h('div',{style:{fontSize:22,fontWeight:800,color:c.streak}},streak+" Day Streak!"),h('div',{style:{fontSize:13,color:c.text,fontWeight:500}},rew.m),rew.r?h('div',{style:{fontSize:12,color:c.success,fontWeight:600,marginTop:4}},rew.r):null,streak<7?h('div',{style:{fontSize:11,color:c.textMuted,marginTop:2}},(7-streak)+" days until ice cream! \uD83C\uDF66"):null))):null,
      h('div',{style:{display:"flex",gap:8,marginBottom:12}},h(SB,{label:"Sleep",value:yL&&yL.sleep?yL.sleep.quality:null,unit:"/10",c:c,color:yL&&yL.sleep&&yL.sleep.quality>=6?c.success:c.warning}),h(SB,{label:"Adherence",value:adh+"%",c:c,color:adh>=80?c.success:c.warning}),h(SB,{label:"Today",value:log.dayRating?{good:"\uD83D\uDE0A",okay:"\uD83D\uDE10",bad:"\uD83D\uDE1E",crisis:"\uD83D\uDE2B"}[log.dayRating]:"\u2014",c:c})),
      log.menstrual&&log.menstrual.status&&log.menstrual.status!=="none"?h('div',{style:{padding:"10px 16px",borderRadius:12,background:c.alertLight,marginBottom:12,fontSize:13,fontWeight:600,color:c.alert}},"\uD83E\uDE78 Period: "+log.menstrual.status+(log.menstrual.cycleDay?" \u00B7 Day "+log.menstrual.cycleDay:"")):null,
      CL([{checked:t.morningHR,label:"Log resting heart rate",icon:"\uD83D\uDC93",field:"morningHR",infoKey:"restingHR"},{checked:t.morningHydration,label:"Morning hydration (16 oz)",icon:"\uD83D\uDCA7",field:"morningHydration",infoKey:"morningHydration"},{checked:t.morningElectrolytes,label:"Morning electrolytes",icon:"\u26A1",field:"morningElectrolytes",sublabel:"LMNT or Liquid IV",infoKey:"electrolytes"}],"\uD83C\uDF05 Wake-Up Protocol",[t.morningHR,t.morningHydration,t.morningElectrolytes].every(Boolean)?"done":ns==="wake"?"now":"upcoming"),
      CL([{checked:t.multivitamin,label:"Basic Nutrients 2/Day",icon:"\uD83D\uDC8A",field:"multivitamin",infoKey:"multivitamin"},{checked:t.vitK2,label:"Vitamin K2",icon:"\uD83D\uDC8A",field:"vitK2",infoKey:"vitK2"},{checked:t.vitB2,label:"Vitamin B2",icon:"\uD83D\uDC8A",field:"vitB2",infoKey:"vitB2"}],"\uD83D\uDC8A Morning Supplements",[t.multivitamin,t.vitK2,t.vitB2].every(Boolean)?"done":ns==="morn"?"now":"upcoming"),
      CL([{checked:t.antimicrobial,label:"Antimicrobial tincture",icon:"\uD83C\uDF3F",field:"antimicrobial",sublabel:"WITH food \u00B7 Before noon",infoKey:"antimicrobial",warning:hr>=12&&!t.antimicrobial?"Past noon":""}],"\uD83C\uDF3F Midday",t.antimicrobial?"done":ns==="mid"?"now":"upcoming"),
      CL([{checked:t.magnesium,label:"Magnesium glycinate",icon:"\uD83D\uDC8A",field:"magnesium",infoKey:"magnesiumGlycinate"},{checked:t.digestiveEnzymes,label:"Digestive enzymes",icon:"\uD83D\uDC8A",field:"digestiveEnzymes",infoKey:"digestiveEnzymes"},{checked:t.movement,label:"Movement/exercise",icon:"\uD83D\uDEB6\u200D\u2640\uFE0F",field:"movement",infoKey:"movement"}],"\uD83C\uDF06 Afternoon/Evening",[t.magnesium,t.digestiveEnzymes].every(Boolean)?"done":ns==="eve"?"now":"upcoming"),
      CL([{checked:t.bedtimeProtocol,label:"Bedroom prepped",icon:"\uD83D\uDECF\uFE0F",field:"bedtimeProtocol",infoKey:"bedroomPrep"},{checked:t.screenFree,label:"Screen-free (1+ hr)",icon:"\uD83D\uDCF5",field:"screenFree",infoKey:"screenFree"},{checked:t.vagalBreathing,label:"Vagal breathing",icon:"\uD83C\uDF2C\uFE0F",field:"vagalBreathing",infoKey:"vagalBreathing"},{checked:log.sleep&&log.sleep.medication&&log.sleep.medication.gabapentin&&log.sleep.medication.gabapentin.taken,label:"Gabapentin 400mg",icon:"\uD83D\uDC8A",field:"_g",infoKey:"gabapentin"}],"\uD83C\uDF19 Bedtime",ns==="bed"?"now":[t.bedtimeProtocol,t.screenFree].every(Boolean)?"done":"upcoming"),
      h(Cd,{c:c},h('div',{style:{display:"flex",alignItems:"center",gap:6,marginBottom:12}},h(SH,{title:"How's today?",icon:"\uD83D\uDCDD",c:c}),h(IB,{ik:"dayRating",c:c})),
        h('div',{style:{display:"flex",gap:8}},
          [["good","\uD83D\uDE0A Good",c.success],["okay","\uD83D\uDE10 Okay",c.primary],["bad","\uD83D\uDE1E Bad",c.warning],["crisis","\uD83D\uDE2B Crisis",c.alert]].map(function(x){return h('button',{key:x[0],onClick:function(){uL(ad,function(p){return Object.assign({},p,{dayRating:x[0]})})},style:{flex:1,padding:"12px 4px",borderRadius:12,border:"2px solid "+(log.dayRating===x[0]?x[2]:c.border),background:log.dayRating===x[0]?x[2]+"20":"transparent",fontSize:13,fontWeight:600,color:c.text,cursor:"pointer"}},x[1])}))),
      h(Cd,{c:c},h(SH,{title:"Quick Note",icon:"\u270F\uFE0F",c:c}),h('textarea',{value:log.notes||"",onChange:function(e){uL(ad,function(p){return Object.assign({},p,{notes:e.target.value})})},placeholder:"How are you feeling?",rows:3,style:{width:"100%",padding:12,borderRadius:10,border:"1px solid "+c.border,background:c.bgCardAlt,color:c.text,fontSize:14,fontFamily:"inherit",resize:"vertical",boxSizing:"border-box"}})));}

  /* ─── LOG ─── */
  function LogView(){
    var log=cur;
    function upS(f,v){uL(ad,function(p){var s=Object.assign({},p.sleep);s[f]=v;return Object.assign({},p,{sleep:s})})}
    function upSy(f,v){uL(ad,function(p){var s=Object.assign({},p.symptoms);s[f]=v;return Object.assign({},p,{symptoms:s})})}
    function upV(f,v){uL(ad,function(p){var vi=Object.assign({},p.vitals);vi[f]=v;return Object.assign({},p,{vitals:vi})})}
    function upM(f,v){uL(ad,function(p){var m=Object.assign({},p.menstrual);m[f]=v;return Object.assign({},p,{menstrual:m})})}

    function ML(){return h('div',null,
      h(Cd,{c:c},h('div',{style:{display:"flex",alignItems:"center",gap:6,marginBottom:8}},h(SH,{title:"Last Night's Sleep",icon:"\uD83D\uDE34",c:c}),h(IB,{ik:"sleepQuality",c:c})),
        [["Bedtime","bedtime"],["Fell asleep","fellAsleep"],["Wake time","wakeTime"]].map(function(x){return h('div',{key:x[1],style:{marginBottom:14}},h('label',{style:{fontSize:13,fontWeight:600,color:c.text,display:"block",marginBottom:6}},x[0]),h('input',{type:"time",value:log.sleep&&log.sleep[x[1]]||"",onChange:function(e){upS(x[1],e.target.value)},style:{width:"100%",padding:12,borderRadius:10,border:"1px solid "+c.border,background:c.bgCardAlt,color:c.text,fontSize:15,fontFamily:"inherit",boxSizing:"border-box"}}))}),
        h(Sl,{label:"Sleep quality",value:log.sleep&&log.sleep.quality,onChange:function(v){upS("quality",v)},lo:"Terrible",hi:"Perfect",c:c}),
        h(Ct,{label:"Night wakings",value:log.sleep&&log.sleep.wakings||0,onChange:function(v){upS("wakings",v)},c:c}),
        h(Tg,{label:"Felt rested?",value:log.sleep&&log.sleep.feltRested||false,onChange:function(v){upS("feltRested",v)},c:c}),
        h('div',{style:{marginTop:16}},h(SH,{title:"Sleep Meds",icon:"\uD83D\uDC8A",c:c})),
        h(Tg,{label:"Gabapentin 400mg",value:log.sleep&&log.sleep.medication&&log.sleep.medication.gabapentin&&log.sleep.medication.gabapentin.taken||false,onChange:function(v){uL(ad,function(p){return Object.assign({},p,{sleep:Object.assign({},p.sleep,{medication:Object.assign({},p.sleep&&p.sleep.medication,{gabapentin:{taken:v,dose:400}})})})})},c:c,ik:"gabapentin"}),
        h(Tg,{label:"Unisom/Doxylamine",value:log.sleep&&log.sleep.medication&&log.sleep.medication.unisom&&log.sleep.medication.unisom.taken||false,onChange:function(v){uL(ad,function(p){return Object.assign({},p,{sleep:Object.assign({},p.sleep,{medication:Object.assign({},p.sleep&&p.sleep.medication,{unisom:Object.assign({},p.sleep&&p.sleep.medication&&p.sleep.medication.unisom,{taken:v})})})})})},c:c,ik:"unisom"}),
        log.sleep&&log.sleep.medication&&log.sleep.medication.unisom&&log.sleep.medication.unisom.taken?h('div',{style:{marginTop:8}},h('label',{style:{fontSize:13,fontWeight:600,color:c.text,marginBottom:6,display:"block"}},"Dose (mg)"),h('input',{type:"number",value:log.sleep.medication.unisom.dose||"",onChange:function(e){uL(ad,function(p){return Object.assign({},p,{sleep:Object.assign({},p.sleep,{medication:Object.assign({},p.sleep.medication,{unisom:Object.assign({},p.sleep.medication.unisom,{dose:Number(e.target.value)})})})})})},style:{width:120,padding:10,borderRadius:10,border:"1px solid "+c.border,background:c.bgCardAlt,color:c.text,fontSize:15,fontFamily:"inherit"}}),(log.sleep.medication.unisom.dose||0)>50?h('div',{style:{marginTop:6,fontSize:12,color:c.warning,fontWeight:500}},"\u26A0\uFE0F High dose"):null):null,
        h(Tg,{label:'"Wired but tired"?',value:log.symptoms&&log.symptoms.wiredButTired||false,onChange:function(v){upSy("wiredButTired",v)},c:c,ik:"wiredButTired"})),
      h(Cd,{c:c},h(SH,{title:"Morning Vitals",icon:"\uD83D\uDC93",c:c}),
        h('div',{style:{display:"flex",gap:12,marginBottom:12}},
          [["Resting HR","morningHR","restingHR"],["Standing HR","standingHR","standingHR"]].map(function(x){return h('div',{key:x[1],style:{flex:1}},h('div',{style:{display:"flex",alignItems:"center",gap:4,marginBottom:6}},h('label',{style:{fontSize:13,fontWeight:600,color:c.text}},x[0]),h(IB,{ik:x[2],c:c})),h('input',{type:"number",value:log.vitals&&log.vitals[x[1]]||"",placeholder:"bpm",onChange:function(e){upV(x[1],Number(e.target.value))},style:{width:"100%",padding:12,borderRadius:10,border:"1px solid "+c.border,background:c.bgCardAlt,color:c.text,fontSize:15,fontFamily:"inherit",boxSizing:"border-box"}}))})),
        log.vitals&&log.vitals.morningHR>100?h('div',{style:{fontSize:12,color:c.alert,fontWeight:500}},"\u26A0\uFE0F Resting HR above 100"):null,
        log.vitals&&log.vitals.standingHR&&log.vitals.morningHR&&(log.vitals.standingHR-log.vitals.morningHR)>30?h('div',{style:{fontSize:12,color:c.warning,fontWeight:500}},"\u26A0\uFE0F HR jumped "+(log.vitals.standingHR-log.vitals.morningHR)+" bpm \u2014 POTS indicator"):null),
      h(Cd,{c:c},h(SH,{title:"Waking Symptoms",icon:"\uD83C\uDF05",c:c}),
        h(Sl,{label:"Energy",value:log.symptoms&&log.symptoms.energy,onChange:function(v){upSy("energy",v)},lo:"Can't move",hi:"Energized",c:c}),
        h(Sl,{label:"Dizziness",value:log.symptoms&&log.symptoms.dizziness,onChange:function(v){upSy("dizziness",v)},lo:"None",hi:"Severe",c:c}),
        h(Sl,{label:"Nausea",value:log.symptoms&&log.symptoms.nausea,onChange:function(v){upSy("nausea",v)},lo:"None",hi:"Severe",c:c}),
        h(Sl,{label:"Anxiety",value:log.symptoms&&log.symptoms.anxiety,onChange:function(v){upSy("anxiety",v)},lo:"Calm",hi:"Severe",c:c}),
        h(Sl,{label:"Mood",value:log.symptoms&&log.symptoms.mood,onChange:function(v){upSy("mood",v)},lo:"Low",hi:"Great",c:c})));}

    function EL(){return h('div',null,
      h(Cd,{c:c},h('div',{style:{display:"flex",alignItems:"center",gap:6,marginBottom:8}},h(SH,{title:"Menstrual",icon:"\uD83E\uDE78",c:c}),h(IB,{ik:"periodTracking",c:c})),
        h('div',{style:{display:"flex",flexWrap:"wrap",gap:8,marginBottom:12}},"none,spotting,light,medium,heavy".split(",").map(function(s){return h(Pl,{key:s,text:s[0].toUpperCase()+s.slice(1),active:log.menstrual&&log.menstrual.status===s,onClick:function(){upM("status",s)},c:c,color:s==="none"?c.textMuted:c.alert})})),
        h('label',{style:{fontSize:13,fontWeight:600,color:c.text,marginBottom:6,display:"block"}},"Cycle day"),
        h('input',{type:"number",value:log.menstrual&&log.menstrual.cycleDay||"",onChange:function(e){upM("cycleDay",Number(e.target.value))},placeholder:"Day",style:{width:100,padding:10,borderRadius:10,border:"1px solid "+c.border,background:c.bgCardAlt,color:c.text,fontSize:15,fontFamily:"inherit"}})),
      h(Cd,{c:c},h(SH,{title:"GI Symptoms",icon:"\uD83E\uDEE0",c:c}),
        h(Sl,{label:"Nausea",value:log.symptoms&&log.symptoms.nausea,onChange:function(v){upSy("nausea",v)},lo:"None",hi:"Severe",c:c}),
        h(Sl,{label:"Burping/Gas",value:log.symptoms&&log.symptoms.burping,onChange:function(v){upSy("burping",v)},lo:"None",hi:"Severe",c:c}),
        h(Sl,{label:"Abdominal discomfort",value:log.symptoms&&log.symptoms.pain,onChange:function(v){upSy("pain",v)},lo:"None",hi:"Severe",c:c}),
        h(Sl,{label:"Appetite",value:log.symptoms&&log.symptoms.appetite,onChange:function(v){upSy("appetite",v)},lo:"Couldn't eat",hi:"Great",c:c})),
      h(Cd,{c:c},h(SH,{title:"Mental/Emotional",icon:"\uD83E\uDDE0",c:c}),
        h(Sl,{label:"Peak anxiety",value:log.symptoms&&log.symptoms.anxiety,onChange:function(v){upSy("anxiety",v)},lo:"Calm",hi:"Severe",c:c}),
        h(Sl,{label:"Mood",value:log.symptoms&&log.symptoms.mood,onChange:function(v){upSy("mood",v)},lo:"Worst",hi:"Great",c:c}),
        h(Sl,{label:"Irritability",value:log.symptoms&&log.symptoms.irritability,onChange:function(v){upSy("irritability",v)},lo:"None",hi:"Severe",c:c}),
        h(Ct,{label:"Panic episodes",value:log.symptoms&&log.symptoms.panicCount||0,onChange:function(v){upSy("panicCount",v)},c:c,color:(log.symptoms&&log.symptoms.panicCount||0)>0?c.alert:c.success})),
      h(Cd,{c:c},h('div',{style:{display:"flex",alignItems:"center",gap:6,marginBottom:8}},h(SH,{title:"Physical",icon:"\uD83E\uDDB4",c:c}),h(IB,{ik:"painNew",c:c})),
        h(Sl,{label:"Dizziness",value:log.symptoms&&log.symptoms.dizziness,onChange:function(v){upSy("dizziness",v)},lo:"None",hi:"Severe",c:c}),
        h(Sl,{label:"NEW pain",value:log.symptoms&&log.symptoms.painNew,onChange:function(v){upSy("painNew",v)},lo:"Just normal",hi:"Worst new",c:c,ik:"painNew"}),
        h(Sl,{label:"Headache",value:log.symptoms&&log.symptoms.headache,onChange:function(v){upSy("headache",v)},lo:"None",hi:"Severe",c:c}),
        h(Sl,{label:"Fatigue",value:log.symptoms&&log.symptoms.fatigue,onChange:function(v){upSy("fatigue",v)},lo:"Fine",hi:"Extreme",c:c})),
      h(Cd,{c:c},h(SH,{title:"Stress & Notes",icon:"\u270F\uFE0F",c:c}),
        h(Sl,{label:"Stress",value:log.stressLevel,onChange:function(v){uL(ad,function(p){return Object.assign({},p,{stressLevel:v})})},lo:"Low",hi:"Extreme",c:c}),
        h(Tg,{label:"Forced early wake?",value:log.earlyWake||false,onChange:function(v){uL(ad,function(p){return Object.assign({},p,{earlyWake:v})})},c:c}),
        h('textarea',{value:log.notes||"",onChange:function(e){uL(ad,function(p){return Object.assign({},p,{notes:e.target.value})})},placeholder:"What helped? What hurt?",rows:4,style:{width:"100%",padding:12,borderRadius:10,border:"1px solid "+c.border,background:c.bgCardAlt,color:c.text,fontSize:14,fontFamily:"inherit",resize:"vertical",boxSizing:"border-box",marginTop:12}})));}

    return h('div',null,h(DN,null),
      h('h1',{style:{margin:"0 0 12px",fontSize:24,fontWeight:800,color:c.text}},"Daily Log"),
      h('div',{style:{display:"flex",gap:8,marginBottom:16}},
        [["morning","\uD83C\uDF05 Morning"],["evening","\uD83C\uDF19 Evening"]].map(function(x){return h('button',{key:x[0],onClick:function(){setLogSub(x[0])},style:{flex:1,padding:"10px 0",borderRadius:12,border:"2px solid "+(logSub===x[0]?c.primary:c.border),background:logSub===x[0]?c.primaryLight:"transparent",color:logSub===x[0]?c.primary:c.textMuted,fontSize:14,fontWeight:600,cursor:"pointer"}},x[1])})),
      logSub==="morning"?h(ML,null):h(EL,null));}

  /* ─── INSIGHTS ─── */
  function InsightsView(){
    var src=allD.slice(-insR),drc={good:c.success,okay:c.accent,bad:c.warning,crisis:c.alert};
    var labels=src.map(function(d){return dn(d)[0]+new Date(d+"T12:00:00").getDate()});
    var sq=src.map(function(d){return logs[d]&&logs[d].sleep?logs[d].sleep.quality:null});
    var anx=src.map(function(d){return logs[d]&&logs[d].symptoms?logs[d].symptoms.anxiety:null});
    var mood=src.map(function(d){return logs[d]&&logs[d].symptoms?logs[d].symptoms.mood:null});
    var rhr=src.map(function(d){return logs[d]&&logs[d].vitals?logs[d].vitals.morningHR:null});
    var shr=src.map(function(d){return logs[d]&&logs[d].vitals?logs[d].vitals.standingHR:null});
    var energy=src.map(function(d){return logs[d]&&logs[d].symptoms?logs[d].symptoms.energy:null});
    var nausea=src.map(function(d){return logs[d]&&logs[d].symptoms?logs[d].symptoms.nausea:null});
    var pain=src.map(function(d){return logs[d]&&logs[d].symptoms?logs[d].symptoms.painNew:null});
    var adh=src.map(function(d){return cA(logs[d])});
    var bd=src.filter(function(d){var r=logs[d]&&logs[d].dayRating;return r==="bad"||r==="crisis"});
    var ew=src.filter(function(d){return logs[d]&&logs[d].earlyWake}),ewQ=ew.map(function(d){return logs[d].sleep&&logs[d].sleep.quality}).filter(Boolean),nwQ=src.filter(function(d){return!logs[d]||!logs[d].earlyWake}).map(function(d){return logs[d]&&logs[d].sleep?logs[d].sleep.quality:null}).filter(Boolean);
    var sqF=sq.filter(Boolean),anxF=anx.filter(Boolean);

    var gridC=dark?"rgba(255,255,255,.08)":"rgba(0,0,0,.06)";
    var tickC=c.textMuted;

    return h('div',null,
      h('div',{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12}},h('h1',{style:{margin:0,fontSize:24,fontWeight:800,color:c.text}},"Insights"),h('div',{style:{display:"flex",gap:4}},[7,14,30].map(function(n){return h(Pl,{key:n,text:n+"d",active:insR===n,onClick:function(){setInsR(n)},c:c})}))),
      h(Cd,{c:c},h(SH,{title:"Your Week",icon:"\uD83D\uDCC5",c:c}),
        h('div',{style:{display:"flex",gap:4,justifyContent:"center",flexWrap:"wrap"}},src.map(function(d){var r=logs[d]&&logs[d].dayRating,em={good:"\uD83D\uDE0A",okay:"\uD83D\uDE10",bad:"\uD83D\uDE1E",crisis:"\uD83D\uDE2B"}[r]||"\u00B7";return h('div',{key:d,style:{textAlign:"center",width:44,cursor:"pointer"},onClick:function(){setVDate(d);setTab("today")}},h('div',{style:{fontSize:9,color:c.textMuted}},dn(d)),h('div',{style:{width:36,height:36,borderRadius:10,background:r?drc[r]+"25":c.bgCardAlt,display:"flex",alignItems:"center",justifyContent:"center",fontSize:18,margin:"0 auto"}},em))})),
        h('div',{style:{fontSize:11,color:c.textMuted,textAlign:"center",marginTop:8}},"Tap any day to view")),
      h(Cd,{c:c},h(SH,{title:"Sleep Quality",icon:"\uD83D\uDE34",c:c}),
        h(CChart,{type:"line",height:170,legend:false,tooltipBg:c.bgCard,borderC:c.border,
          data:{labels:labels,datasets:[{label:"Quality",data:sq,borderColor:c.primary,backgroundColor:c.primary+"30",fill:true,tension:.4,pointRadius:4,pointBackgroundColor:c.primary,borderWidth:2.5}]},
          scales:{y:{min:0,max:10,grid:{color:gridC},ticks:{color:tickC,font:{size:10}}},x:{grid:{display:false},ticks:{color:tickC,font:{size:9}}}}}),
        h('div',{style:{fontSize:12,color:c.textMuted,marginTop:4}},"Avg: "+av(sqF)+"/10")),
      h(Cd,{c:c},h(SH,{title:"Anxiety vs Mood",icon:"\uD83E\uDDE0",c:c}),
        h(CChart,{type:"line",height:170,legend:true,tooltipBg:c.bgCard,borderC:c.border,
          data:{labels:labels,datasets:[{label:"Anxiety",data:anx,borderColor:c.warning,backgroundColor:"transparent",tension:.4,pointRadius:3,borderWidth:2},{label:"Mood",data:mood,borderColor:c.success,backgroundColor:"transparent",tension:.4,pointRadius:3,borderWidth:2}]},
          scales:{y:{min:0,max:10,grid:{color:gridC},ticks:{color:tickC,font:{size:10}}},x:{grid:{display:false},ticks:{color:tickC,font:{size:9}}}}})),
      h(Cd,{c:c},h(SH,{title:"Energy / Nausea / Pain",icon:"\u26A1",c:c}),
        h(CChart,{type:"line",height:170,legend:true,tooltipBg:c.bgCard,borderC:c.border,
          data:{labels:labels,datasets:[{label:"Energy",data:energy,borderColor:c.success,backgroundColor:"transparent",tension:.4,pointRadius:3,borderWidth:2},{label:"Nausea",data:nausea,borderColor:c.alert,backgroundColor:"transparent",tension:.4,pointRadius:3,borderWidth:2},{label:"Pain (new)",data:pain,borderColor:c.warning,backgroundColor:"transparent",tension:.4,pointRadius:3,borderWidth:2,borderDash:[4,3]}]},
          scales:{y:{min:0,max:10,grid:{color:gridC},ticks:{color:tickC,font:{size:10}}},x:{grid:{display:false},ticks:{color:tickC,font:{size:9}}}}})),
      h(Cd,{c:c},h(SH,{title:"Heart Rate (POTS)",icon:"\uD83D\uDC93",c:c}),
        h(CChart,{type:"line",height:170,legend:true,tooltipBg:c.bgCard,borderC:c.border,
          data:{labels:labels,datasets:[{label:"Resting",data:rhr,borderColor:c.primary,backgroundColor:"transparent",tension:.3,pointRadius:3,borderWidth:2},{label:"Standing",data:shr,borderColor:c.warning,backgroundColor:"transparent",tension:.3,pointRadius:3,borderWidth:2}]},
          scales:{y:{min:50,max:150,grid:{color:gridC},ticks:{color:tickC,font:{size:10}}},x:{grid:{display:false},ticks:{color:tickC,font:{size:9}}}}}),
        h('div',{style:{fontSize:12,color:c.textMuted,marginTop:4}},"30+ bpm gap may indicate POTS")),
      h(Cd,{c:c},h(SH,{title:"Adherence",icon:"\uD83D\uDCCB",c:c}),
        h(CChart,{type:"bar",height:150,legend:false,tooltipBg:c.bgCard,borderC:c.border,
          data:{labels:labels,datasets:[{label:"%",data:adh,backgroundColor:adh.map(function(v){return v>=80?c.success+"B0":v>=50?c.warning+"B0":c.alert+"B0"}),borderRadius:4}]},
          scales:{y:{min:0,max:100,grid:{color:gridC},ticks:{color:tickC,font:{size:10}}},x:{grid:{display:false},ticks:{color:tickC,font:{size:9}}}}})),
      h(Cd,{c:c,style:{background:"linear-gradient(135deg,"+c.primaryLight+","+c.successLight+")",border:"1px solid "+c.primaryMid}},
        h(SH,{title:"What the Data Says",icon:"\uD83D\uDCA1",c:c}),
        h('div',{style:{display:"flex",flexDirection:"column",gap:12}},
          ewQ.length>0&&nwQ.length>0&&parseFloat(av(nwQ))>parseFloat(av(ewQ))?h('div',{style:{background:c.bgCard,borderRadius:12,padding:14}},h('div',{style:{fontSize:14,fontWeight:700,color:c.text,marginBottom:4}},"\uD83D\uDE34 Sleeping In Helps!"),h('div',{style:{fontSize:13,color:c.textMuted,lineHeight:1.5}},"Natural: "+av(nwQ)+"/10. Forced: "+av(ewQ)+"/10.")):null,
          bd.length>0?h('div',{style:{background:c.bgCard,borderRadius:12,padding:14}},h('div',{style:{fontSize:14,fontWeight:700,color:c.text,marginBottom:4}},"\uD83D\uDD0D Bad Day Patterns"),h('div',{style:{fontSize:13,color:c.textMuted,lineHeight:1.5}},bd.length+" tough days: "+bd.filter(function(d){return logs[d]&&logs[d].earlyWake}).length+" early wakes, "+bd.filter(function(d){return logs[d]&&logs[d].symptoms&&logs[d].symptoms.wiredButTired}).length+" wired.")):null,
          h('div',{style:{background:c.bgCard,borderRadius:12,padding:14}},h('div',{style:{fontSize:14,fontWeight:700,color:c.text,marginBottom:4}},"\uD83D\uDCC8 Numbers"),h('div',{style:{fontSize:13,color:c.textMuted,lineHeight:1.7}},"Sleep: "+av(sqF)+"/10 \u00B7 Anxiety: "+av(anxF)+"/10 \u00B7 Panic: "+src.filter(function(d){return logs[d]&&logs[d].symptoms&&logs[d].symptoms.panicCount>0}).length+"/"+src.length+" \u00B7 Wired: "+src.filter(function(d){return logs[d]&&logs[d].symptoms&&logs[d].symptoms.wiredButTired}).length+"/"+src.length)))));}

  /* ─── SETTINGS ─── */
  function SettingsView(){
    var _er=useState("7"),eR=_er[0],sER=_er[1];
    function genExp(r){var ds=r==="all"?allD:allD.slice(-parseInt(r));if(!ds.length)return"No data.";var t="=== SAMI HEALTH REPORT ===\n"+sd(ds[0])+" \u2014 "+sd(ds[ds.length-1])+" ("+ds.length+" days)\n\nSleep: "+av(ds.map(function(d){return logs[d]&&logs[d].sleep?logs[d].sleep.quality:null}).filter(Boolean))+"/10\nWired: "+ds.filter(function(d){return logs[d]&&logs[d].symptoms&&logs[d].symptoms.wiredButTired}).length+"/"+ds.length+"\nEarly wakes: "+ds.filter(function(d){return logs[d]&&logs[d].earlyWake}).length+"/"+ds.length+"\n";["anxiety","nausea","energy","mood","dizziness"].forEach(function(k){var v=ds.map(function(d){return logs[d]&&logs[d].symptoms?logs[d].symptoms[k]:null}).filter(function(x){return x!=null});if(v.length)t+=k+": "+av(v)+"/10\n"});var r2={good:0,okay:0,bad:0,crisis:0};ds.forEach(function(d){if(logs[d]&&logs[d].dayRating)r2[logs[d].dayRating]++});t+="\nGood:"+r2.good+" Okay:"+r2.okay+" Bad:"+r2.bad+" Crisis:"+r2.crisis+"\nAdherence: "+av(ds.map(function(d){return cA(logs[d])}))+"%\n";var notes=ds.filter(function(d){return logs[d]&&logs[d].notes});if(notes.length){t+="\n=== NOTES ===\n";notes.forEach(function(d){t+=sd(d)+": "+logs[d].notes+"\n\n"})}return t}
    function genCSV(r){var ds=r==="all"?allD:allD.slice(-parseInt(r));return"Date,Rating,SleepQ,Wired,EarlyWake,RestHR,StandHR,Anxiety,Mood,Energy,Adherence,Notes\n"+ds.map(function(d){var l=logs[d];return[d,l&&l.dayRating||"",l&&l.sleep?l.sleep.quality:"",l&&l.symptoms&&l.symptoms.wiredButTired?"Y":"N",l&&l.earlyWake?"Y":"N",l&&l.vitals?l.vitals.morningHR:"",l&&l.vitals?l.vitals.standingHR:"",l&&l.symptoms?l.symptoms.anxiety:"",l&&l.symptoms?l.symptoms.mood:"",l&&l.symptoms?l.symptoms.energy:"",cA(l),'"'+(l&&l.notes||"").replace(/"/g,"'")+'"'].join(",")}).join("\n")}
    return h('div',null,
      h('h1',{style:{margin:"0 0 16px",fontSize:24,fontWeight:800,color:c.text}},"Settings"),
      samShow&&Object.values(logs).some(function(l){return l._isSample})?h(Cd,{c:c,style:{border:"1.5px solid "+c.warning,background:c.warningLight}},h('div',{style:{fontSize:14,fontWeight:700,color:c.text,marginBottom:6}},"\uD83D\uDCCA Sample Data Active"),h('button',{onClick:function(){setLogs(function(p){var cl={};Object.entries(p).forEach(function(x){if(!x[1]._isSample)cl[x[0]]=x[1]});return cl});setSamShow(false)},style:{width:"100%",padding:12,borderRadius:12,border:"none",background:c.warning,color:"#fff",fontSize:14,fontWeight:700,cursor:"pointer"}},"Clear Sample Data")):null,
      h(Cd,{c:c},h(SH,{title:"Preferences",icon:"\u2699\uFE0F",c:c}),
        [["Bedtime","bedtime"],["Wake time","wakeTime"]].map(function(x){return h('div',{key:x[1],style:{marginBottom:14}},h('label',{style:{fontSize:13,fontWeight:600,color:c.text,display:"block",marginBottom:6}},x[0]),h('input',{type:"time",value:prefs[x[1]],onChange:function(e){setPrefs(Object.assign({},prefs,function(){var o={};o[x[1]]=e.target.value;return o}()))},style:{width:"100%",padding:12,borderRadius:10,border:"1px solid "+c.border,background:c.bgCardAlt,color:c.text,fontSize:15,fontFamily:"inherit",boxSizing:"border-box"}}))}),
        h(Tg,{label:"Dark mode",value:dark,onChange:setDark,c:c})),
      h(Cd,{c:c},h(SH,{title:"Export",icon:"\uD83D\uDCE4",c:c}),
        h('div',{style:{display:"flex",gap:6,marginBottom:14,flexWrap:"wrap"}},[["7","7d"],["14","14d"],["30","30d"],["all","All"]].map(function(x){return h(Pl,{key:x[0],text:x[1],active:eR===x[0],onClick:function(){sER(x[0])},c:c})})),
        h('button',{onClick:function(){setExpTxt(genExp(eR));setExpShow(true)},style:{width:"100%",padding:14,borderRadius:12,border:"none",background:c.primary,color:"#fff",fontSize:15,fontWeight:700,cursor:"pointer",marginBottom:10}},"\uD83D\uDCCB Report"),
        h('button',{onClick:function(){var b=new Blob([genCSV(eR)],{type:"text/csv"});var a=document.createElement("a");a.href=URL.createObjectURL(b);a.download="sami_"+eR+".csv";a.click()},style:{width:"100%",padding:14,borderRadius:12,border:"2px solid "+c.primary,background:"transparent",color:c.primary,fontSize:15,fontWeight:700,cursor:"pointer"}},"\uD83D\uDCCA CSV")),
      h(Cd,{c:c},h(SH,{title:"Backup",icon:"\uD83D\uDCBE",c:c}),
        h('button',{onClick:function(){var b=new Blob([JSON.stringify({logs:logs,prefs:prefs,dark:dark},null,2)],{type:"application/json"});var a=document.createElement("a");a.href=URL.createObjectURL(b);a.download="sami_backup.json";a.click()},style:{width:"100%",padding:14,borderRadius:12,border:"none",background:c.success,color:"#fff",fontSize:15,fontWeight:700,cursor:"pointer",marginBottom:10}},"\uD83D\uDCBE Full Backup"),
        h('button',{onClick:function(){setImpShow(true)},style:{width:"100%",padding:14,borderRadius:12,border:"2px solid "+c.success,background:"transparent",color:c.success,fontSize:15,fontWeight:700,cursor:"pointer"}},"\uD83D\uDCE5 Restore")),
      h(Cd,{c:c},h(SH,{title:"Help",icon:"\u2753",c:c}),h('div',{style:{fontSize:13,color:c.textMuted,lineHeight:1.8}},
        h('p',null,h('b',{style:{color:c.text}},"Today:")," Checklist. Tap \u2713, tap ? to learn."),
        h('p',null,h('b',{style:{color:c.text}},"Log:")," Morning=sleep. Evening=symptoms."),
        h('p',null,h('b',{style:{color:c.text}},"Insights:")," Charts + patterns."),
        h('p',null,h('b',{style:{color:c.text}},"Streaks:")," 7d=\uD83C\uDF66  21d=habit  30d=\uD83D\uDC51"),
        h('p',{style:{fontStyle:"italic",color:c.primary,marginTop:12}},"\uD83D\uDC9C Missing a day is okay."))));}

  /* ─── Crisis ─── */
  function CM(){
    var _ct=useState([]),ct=_ct[0],sCT=_ct[1];var _cs=useState([]),cs=_cs[0],sCS=_cs[1];var _iv=useState([]),iv=_iv[0],sIV=_iv[1];var _cn=useState(""),cn=_cn[0],sCN=_cn[1];var _pn=useState(""),pn=_pn[0],sPN=_pn[1];
    function tg(arr,setter,v){setter(arr.includes(v)?arr.filter(function(x){return x!==v}):arr.concat([v]))}
    return h('div',{style:{position:"fixed",inset:0,zIndex:1000,background:"rgba(0,0,0,.5)",display:"flex",alignItems:"flex-end",justifyContent:"center"}},
      h('div',{style:{background:c.bgCard,borderRadius:"24px 24px 0 0",maxWidth:480,width:"100%",maxHeight:"90vh",overflow:"auto",padding:"24px 20px 40px"}},
        h('div',{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12}},h('h2',{style:{margin:0,fontSize:20,fontWeight:800,color:c.crisis}},"\uD83D\uDEA8 Crisis Log"),h('button',{onClick:function(){setCrisis(false)},style:{background:"none",border:"none",fontSize:24,color:c.textMuted,cursor:"pointer"}},"\u2715")),
        h('p',{style:{fontSize:13,color:c.textMuted,marginBottom:16}},"You're safe. Take your time."),
        h(SH,{title:"What's happening?",c:c}),
        h('div',{style:{display:"flex",flexWrap:"wrap",gap:8,marginBottom:16}},[["severe_panic","Severe Panic"],["er_visit","ER Visit"],["cant_sleep","Can't Sleep"],["hr_over_120","HR >120"]].map(function(x){return h(Pl,{key:x[0],text:x[1],active:ct.includes(x[0]),onClick:function(){tg(ct,sCT,x[0])},c:c,color:c.crisis})})),
        h(SH,{title:"Symptoms",c:c}),
        h('div',{style:{display:"flex",flexWrap:"wrap",gap:8,marginBottom:16}},[["racing_heart","Racing Heart"],["cant_breathe","Can't Breathe"],["panic","Panic"],["dizzy","Dizzy"]].map(function(x){return h(Pl,{key:x[0],text:x[1],active:cs.includes(x[0]),onClick:function(){tg(cs,sCS,x[0])},c:c,color:c.warning})})),
        h(SH,{title:"What helped?",c:c}),
        h('div',{style:{display:"flex",flexWrap:"wrap",gap:8,marginBottom:16}},[["cold_water","Cold Water"],["breathing","Breathing"],["extra_med","Extra Meds"],["called_doc","Doctor"]].map(function(x){return h(Pl,{key:x[0],text:x[1],active:iv.includes(x[0]),onClick:function(){tg(iv,sIV,x[0])},c:c,color:c.success})})),
        h('textarea',{value:cn,onChange:function(e){sCN(e.target.value)},placeholder:"What's different?",rows:2,style:{width:"100%",padding:12,borderRadius:10,border:"1px solid "+c.border,background:c.bgCardAlt,color:c.text,fontSize:14,fontFamily:"inherit",resize:"vertical",boxSizing:"border-box",marginBottom:10}}),
        h('textarea',{value:pn,onChange:function(e){sPN(e.target.value)},placeholder:"Partner notes (Trevor)",rows:2,style:{width:"100%",padding:12,borderRadius:10,border:"1px solid "+c.border,background:c.bgCardAlt,color:c.text,fontSize:14,fontFamily:"inherit",resize:"vertical",boxSizing:"border-box",marginBottom:16}}),
        h('button',{onClick:function(){uL(tk,function(p){return Object.assign({},p,{crisisEvents:(p.crisisEvents||[]).concat([{timestamp:new Date().toISOString(),type:ct,symptoms:cs,interventions:iv,note:cn,partnerNote:pn}]),dayRating:"crisis"})});setCrisis(false)},style:{width:"100%",padding:16,borderRadius:14,border:"none",background:c.crisis,color:"#fff",fontSize:16,fontWeight:700,cursor:"pointer"}},"Save Crisis Log")));}

  if(!loaded)return h('div',{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:c.bg}},h('div',{style:{textAlign:"center",color:c.textMuted}},"\uD83D\uDC9C Loading..."));

  return h('div',{style:{minHeight:"100vh",background:c.bg}},
    h('div',{style:{position:"sticky",top:0,zIndex:50,background:c.bg+"ee",backdropFilter:"blur(10px)",borderBottom:"1px solid "+c.border,padding:"12px 20px",display:"flex",justifyContent:"space-between",alignItems:"center"}},
      h('span',{style:{fontSize:16,fontWeight:800,color:c.primary}},"\uD83D\uDC9C Sami's Health"),
      h('div',{style:{display:"flex",alignItems:"center",gap:10}},
        streak>0?h('span',{style:{fontSize:12,fontWeight:700,color:c.streak,background:c.streak+"15",padding:"2px 8px",borderRadius:8}},rew.e+" "+streak):null,
        h('span',{style:{fontSize:12,color:c.textMuted}},new Date().toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})))),
    h('div',{style:{padding:"12px 16px 100px",maxWidth:480,margin:"0 auto",overflowY:"auto",height:"calc(100vh - 110px)",WebkitOverflowScrolling:"touch"}},
      tab==="today"?h(TodayView,null):null,tab==="log"?h(LogView,null):null,tab==="insights"?h(InsightsView,null):null,tab==="settings"?h(SettingsView,null):null),
    h('button',{onClick:function(){setCrisis(true)},style:{position:"fixed",bottom:76,right:16,zIndex:100,width:52,height:52,borderRadius:26,background:c.crisis,border:"none",color:"#fff",fontSize:22,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",boxShadow:"0 4px 16px "+c.crisis+"40"}},"\uD83D\uDEA8"),
    h('nav',{style:{position:"fixed",bottom:0,left:0,right:0,zIndex:50,background:c.bgCard,borderTop:"1px solid "+c.border,display:"flex",justifyContent:"space-around",padding:"6px 0 max(6px, env(safe-area-inset-bottom))"}},
      [["today","\uD83C\uDFE0","Today"],["log","\uD83D\uDCDD","Log"],["insights","\uD83D\uDCCA","Insights"],["settings","\u2699\uFE0F","Settings"]].map(function(x){return h('button',{key:x[0],onClick:function(){setTab(x[0]);if(x[0]!=="log"&&x[0]!=="today")setVDate(null)},style:{background:"none",border:"none",display:"flex",flexDirection:"column",alignItems:"center",gap:2,padding:"4px 12px",cursor:"pointer"}},h('span',{style:{fontSize:20,opacity:tab===x[0]?1:.5}},x[1]),h('span',{style:{fontSize:10,fontWeight:600,color:tab===x[0]?c.primary:c.textMuted}},x[2]))})),
    crisis?h(CM,null):null,
    expShow?h('div',{style:{position:"fixed",inset:0,zIndex:1000,background:"rgba(0,0,0,.5)",display:"flex",alignItems:"flex-end",justifyContent:"center"}},h('div',{style:{background:c.bgCard,borderRadius:"24px 24px 0 0",maxWidth:480,width:"100%",maxHeight:"90vh",overflow:"auto",padding:"24px 20px 40px"}},h('div',{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12}},h('h2',{style:{margin:0,fontSize:18,fontWeight:800,color:c.text}},"\uD83D\uDCCB Report"),h('button',{onClick:function(){setExpShow(false)},style:{background:"none",border:"none",fontSize:24,color:c.textMuted,cursor:"pointer"}},"\u2715")),h('pre',{style:{fontSize:11,color:c.text,background:c.bgCardAlt,padding:16,borderRadius:12,overflow:"auto",maxHeight:360,whiteSpace:"pre-wrap",lineHeight:1.5}},expTxt),h('div',{style:{display:"flex",gap:10,marginTop:16}},h('button',{onClick:function(){navigator.clipboard&&navigator.clipboard.writeText(expTxt).then(function(){alert("Copied!")})},style:{flex:1,padding:14,borderRadius:12,border:"none",background:c.primary,color:"#fff",fontSize:14,fontWeight:700,cursor:"pointer"}},"Copy"),h('button',{onClick:function(){var b=new Blob([expTxt],{type:"text/plain"});var a=document.createElement("a");a.href=URL.createObjectURL(b);a.download="sami_report.txt";a.click()},style:{flex:1,padding:14,borderRadius:12,border:"2px solid "+c.primary,background:"transparent",color:c.primary,fontSize:14,fontWeight:700,cursor:"pointer"}},"Save")))):null,
    impShow?h('div',{style:{position:"fixed",inset:0,zIndex:1000,background:"rgba(0,0,0,.5)",display:"flex",alignItems:"center",justifyContent:"center",padding:20}},h('div',{style:{background:c.bgCard,borderRadius:20,maxWidth:400,width:"100%",padding:24}},h('h2',{style:{margin:"0 0 12px",fontSize:18,fontWeight:800,color:c.text}},"\uD83D\uDCE5 Restore"),h('input',{type:"file",accept:".json",onChange:function(e){var f=e.target.files&&e.target.files[0];if(!f)return;var r=new FileReader();r.onload=function(ev){try{var d=JSON.parse(ev.target.result);if(d.logs&&confirm("Found "+Object.keys(d.logs).length+" days. Replace?")){setLogs(d.logs);if(d.prefs)setPrefs(d.prefs);if(d.dark!==undefined)setDark(d.dark);setImpShow(false);alert("Restored!")}}catch(e2){alert("Invalid.")}};r.readAsText(f)},style:{marginBottom:16}}),h('button',{onClick:function(){setImpShow(false)},style:{width:"100%",padding:12,borderRadius:12,border:"2px solid "+c.border,background:"transparent",color:c.textMuted,fontSize:14,fontWeight:600,cursor:"pointer"}},"Cancel"))):null);
}

ReactDOM.render(h(App,null),document.getElementById("root"));
})();
</script>
</body>
</html>
